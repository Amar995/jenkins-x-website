<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Jenkins X - Cloud Native CI/CD Built On Kubernetes â€“ Troubleshooting</title>
    <link>https://jenkins-x.io/v3/admin/troubleshooting/</link>
    <description>Recent content in Troubleshooting on Jenkins X - Cloud Native CI/CD Built On Kubernetes</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="https://jenkins-x.io/v3/admin/troubleshooting/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>V3: Install</title>
      <link>https://jenkins-x.io/v3/admin/troubleshooting/install/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://jenkins-x.io/v3/admin/troubleshooting/install/</guid>
      <description>
        
        
        &lt;h2 id=&#34;check-you-are-using-a-cluster-git-url&#34;&gt;Check you are using a cluster Git URL&lt;/h2&gt;
&lt;p&gt;If using Terraform make sure the &lt;code&gt;values.auto.tfvars&lt;/code&gt; file contains a &lt;code&gt;jx_git_url = &lt;/code&gt; value that points to a &lt;strong&gt;cluster&lt;/strong&gt; git repo that contains a helmfile.yaml and a folder ./helmfiles. A common mistake is users set the &lt;code&gt;jx_git_url&lt;/code&gt; to the infrastruture repo instead.&lt;/p&gt;
&lt;p&gt;After a successful bootjob, these are few things to look for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Secrets have been generated in the secret backend.&lt;/li&gt;
&lt;li&gt;A webhook has been created in the cluster git repo.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;issues-with-secret-generation&#34;&gt;Issues with secret generation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;In some cases, the webhook generation will fail with a message :&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;jx gitops webhook update --warn-on-fail
Error: failed to find hmac token from secret:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is normally because the secret generation failed during the boot job.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Look at the outputs from &lt;code&gt;jx secret verify&lt;/code&gt; and &lt;code&gt;kubectl get es -A&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;If you see errors (&lt;code&gt;404 missing&lt;/code&gt;), it most likely means that the secret generation step in the boot log did not work.&lt;/li&gt;
&lt;li&gt;One way to re-generate secrets is by makine a direct push to the base branch of the cluster git repo.&lt;/li&gt;
&lt;li&gt;A direct push to the master (not by creating a pull request) branch will run &lt;code&gt;regen-phase-1&lt;/code&gt;, &lt;code&gt;regen-phase-2&lt;/code&gt; and &lt;code&gt;regen-phase-3&lt;/code&gt;.
Check the admin logs to verify these steps were executed without failing.
&lt;code&gt;regen-phase-3&lt;/code&gt; is where the secret generation happens.
This step runs &lt;code&gt;jx secret populate&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Errors can happen with different secret backends
&lt;ul&gt;
&lt;li&gt;External vault:
&lt;ul&gt;
&lt;li&gt;Ensure you have followed the instruction &lt;a href=&#34;https://github.com/jenkins-x/terraform-aws-eks-jx#secrets-management&#34;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;After terraform apply, a secret &lt;code&gt;jx-boot-job-env-vars&lt;/code&gt; in the &lt;code&gt;jx-git-operator&lt;/code&gt; namespace should be created with two variables defined - EXTERNAL_VAULT (set to &lt;code&gt;true&lt;/code&gt;) and VAULT_ADDR (set to your external vault ip with port).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Wrong cluster git repo
&lt;ul&gt;
&lt;li&gt;If you are using backends other than vault, use the right cluster git repository for that secret backend.
For example, use &lt;code&gt;jx3-eks-asm&lt;/code&gt; template repository to generate the cluster git repository if you want to store secrets in AWS secrets manager.&lt;/li&gt;
&lt;li&gt;Check &lt;a href=&#34;https://github.com/jx3-gitops-repositories&#34;&gt;this github organization&lt;/a&gt; for all the different public template repositories you can use with Jenkins X.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;issues-with-webhook&#34;&gt;Issues with webhook&lt;/h2&gt;
&lt;p&gt;To find if webhooks were created by Jenkins X, navigate to the settings page of your repository, and click on webhooks.
Check the &lt;a href=&#34;https://jenkins-x.io/v3/admin/troubleshooting/webhooks/&#34;&gt;webhook troubleshooting guide&lt;/a&gt; if they exist, and do not work.&lt;/p&gt;
&lt;p&gt;The recent delivery tab should have good debugging information on why webhooks failed to deliver payload.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>V3: Bot Token</title>
      <link>https://jenkins-x.io/v3/admin/troubleshooting/bot-token/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://jenkins-x.io/v3/admin/troubleshooting/bot-token/</guid>
      <description>
        
        
        &lt;h1 id=&#34;commons-problems-with-bot-tokens&#34;&gt;Commons problems with Bot Tokens&lt;/h1&gt;
&lt;p&gt;Make sure the bot user has access to the organisation and / or git repositories that it needs.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;tip&lt;/em&gt; you can accept an organisation and repo GitHub invitation using&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jx admin invitation
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Make sure the bot token has the correct permissions to perform the action you require&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>V3: Secrets</title>
      <link>https://jenkins-x.io/v3/admin/troubleshooting/secrets/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://jenkins-x.io/v3/admin/troubleshooting/secrets/</guid>
      <description>
        
        
        &lt;h1 id=&#34;commons-problems-with-secrets&#34;&gt;Commons problems with Secrets&lt;/h1&gt;
&lt;p&gt;Things to check:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the general health&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jx health status -A
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;the boot job&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;jx admin logs
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;and make sure in the logs &lt;code&gt;jx secret populate&lt;/code&gt; command is successful.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;check the external secrets deployment and logs&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get pods -n secret-infra
kubectl logs deploy/kubernetes-external-secrets -n secret-infra
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;check the status of the external secret using &lt;code&gt;kubectl&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get es -n [the namespace the secret / external secret is in]
&lt;/code&gt;&lt;/pre&gt;
      </description>
    </item>
    
    <item>
      <title>V3: Webhooks</title>
      <link>https://jenkins-x.io/v3/admin/troubleshooting/webhooks/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://jenkins-x.io/v3/admin/troubleshooting/webhooks/</guid>
      <description>
        
        
        &lt;p&gt;Webhooks are used to trigger &lt;a href=&#34;https://github.com/jenkins-x/lighthouse&#34;&gt;lighthouse&lt;/a&gt; when you:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;merge commits to your main branch&lt;/li&gt;
&lt;li&gt;open a Pull Request&lt;/li&gt;
&lt;li&gt;push code to a Pull Request branch&lt;/li&gt;
&lt;li&gt;comment on a Pull Request to trigger ChatOps&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If webhooks are not working in your cluster then you won&amp;rsquo;t get ChatOps or pipelines triggered.&lt;/p&gt;
&lt;h3 id=&#34;requirements&#34;&gt;Requirements&lt;/h3&gt;
&lt;p&gt;For webhooks to work you must have a working &lt;code&gt;Ingress&lt;/code&gt; for the &lt;code&gt;hook&lt;/code&gt; endpoint from &lt;a href=&#34;https://github.com/jenkins-x/lighthouse&#34;&gt;lighthouse&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The ingress defaults to using the domain name specified in &lt;code&gt;ingress.domain&lt;/code&gt; in your &lt;code&gt;jx-requirements.yml&lt;/code&gt; file.&lt;/p&gt;
&lt;h3 id=&#34;diagnosing-issues&#34;&gt;Diagnosing issues&lt;/h3&gt;
&lt;p&gt;You can check on the health of your system and webhooks via the &lt;a href=&#34;https://jenkins-x.io/v3/admin/setup/health/&#34;&gt;Health guide&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;First make sure you have a valid ingress for hook&amp;hellip;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# switch to the jx namespace&lt;/span&gt;
jx ns jx

kubectl get ing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;you should see an ingress with a valid domain name for &lt;code&gt;hook&lt;/code&gt;. Then try curl that URL on the command line&amp;hellip;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;curl -v http://hook-jx.1.2.3.4.nip.io/hook
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;and check your laptop can access the endpoint. Do you have a running &lt;code&gt;lighthouse-webhook-*&lt;/code&gt; pod?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl get pod -l app&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;lighthouse-webhooks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You could look at your pods in &lt;code&gt;jx ui&lt;/code&gt; to see their state, events, logs etc.&lt;/p&gt;
&lt;p&gt;If everything looks to be working inside your cluster then open the git repository of your dev cluster&amp;hellip;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kubectl get environments
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then click the &lt;code&gt;GIT URL&lt;/code&gt; link for your repository.&lt;/p&gt;
&lt;p&gt;Now look at the &lt;strong&gt;Webbooks&lt;/strong&gt; page to see if your git provider could send webhooks to your hook endpoint. On GitHub thats &lt;strong&gt;Settings&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Webhooks&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It could be your git provider can&amp;rsquo;t see public ingress endpoint? If thats the case you may need to look at setting up a tunnel via something like &lt;a href=&#34;https://jenkins-x.io/v3/admin/platforms/on-premises/#enable-webhooks&#34;&gt;ngrok to enable on-premises webhooks&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;aws-specific-issues&#34;&gt;AWS specific issues&lt;/h3&gt;
&lt;p&gt;If you are using AWS you can check out the &lt;a href=&#34;https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-elb-load-balancer.html&#34;&gt;AWS docs on using ELB&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
